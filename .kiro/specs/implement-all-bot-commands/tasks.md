# Задачи: Реализация всех команд бота

## Задача 1: Инициализация ConfigurationCommands ✅
**Статус:** Готово к выполнению
**Приоритет:** Высокий
**Оценка:** 15 минут

### Описание
Добавить инициализацию ConfigurationCommands в конструктор TelegramBot.

### Файлы
- `bot/bot.py`

### Действия
1. Импортировать ConfigurationCommands
2. Создать экземпляр в `__init__()`
3. Сохранить ссылку в `self.config_commands`

### Критерии приемки
- ConfigurationCommands инициализирован
- Доступен через `self.config_commands`

---

## Задача 2: Создание методов-оберток для конфигурационных команд ✅
**Статус:** Готово к выполнению
**Приоритет:** Высокий
**Оценка:** 1 час

### Описание
Создать методы-обертки в TelegramBot для всех конфигурационных команд.

### Файлы
- `bot/bot.py`

### Команды для реализации
1. `reload_config_command` - перезагрузить конфигурацию
2. `config_status_command` - статус конфигурации
3. `list_parsing_rules_command` - список правил парсинга
4. `add_parsing_rule_command` - добавить правило
5. `update_parsing_rule_command` - обновить правило
6. `export_config_command` - экспорт конфигурации
7. `import_config_command` - импорт конфигурации
8. `backup_config_command` - создать бэкап
9. `restore_config_command` - восстановить из бэкапа
10. `list_backups_command` - список бэкапов
11. `validate_config_command` - валидация конфигурации

### Шаблон метода
```python
async def reload_config_command(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Команда /reload_config - перезагрузить конфигурацию без перезапуска"""
    await self.config_commands.reload_config_command(update, context)
```

### Критерии приемки
- Все 11 методов созданы
- Каждый метод имеет docstring
- Методы вызывают соответствующие методы ConfigurationCommands

---

## Задача 3: Регистрация конфигурационных команд ✅
**Статус:** Готово к выполнению
**Приоритет:** Высокий
**Оценка:** 30 минут

### Описание
Зарегистрировать все конфигурационные команды в методе `setup_handlers()`.

### Файлы
- `bot/bot.py`

### Действия
1. Найти метод `setup_handlers()`
2. Добавить секцию "Configuration Management Commands"
3. Зарегистрировать все 11 команд

### Код для добавления
```python
# Configuration Management Commands
CommandHandler("reload_config", self.reload_config_command),
CommandHandler("config_status", self.config_status_command),
CommandHandler("list_parsing_rules", self.list_parsing_rules_command),
CommandHandler("add_parsing_rule", self.add_parsing_rule_command),
CommandHandler("update_parsing_rule", self.update_parsing_rule_command),
CommandHandler("export_config", self.export_config_command),
CommandHandler("import_config", self.import_config_command),
CommandHandler("backup_config", self.backup_config_command),
CommandHandler("restore_config", self.restore_config_command),
CommandHandler("list_backups", self.list_backups_command),
CommandHandler("validate_config", self.validate_config_command),
```

### Критерии приемки
- Все команды зарегистрированы
- Команды добавлены в список handlers
- Логирование регистрации работает

---

## Задача 4: Проверка ConfigurationCommands ✅
**Статус:** Готово к выполнению
**Приоритет:** Средний
**Оценка:** 2 часа

### Описание
Проверить и при необходимости дополнить реализацию ConfigurationCommands.

### Файлы
- `bot/commands/config_commands.py`

### Проверки
1. Все методы имеют правильную сигнатуру
2. Используется AdminManager для проверки прав
3. Есть обработка ошибок
4. Логирование действий
5. Информативные сообщения об ошибках

### Что проверить в каждом методе
- [ ] Проверка прав администратора
- [ ] Валидация входных параметров
- [ ] Try-except блоки
- [ ] Логирование с structlog
- [ ] Понятные сообщения пользователю
- [ ] HTML-форматирование
- [ ] Закрытие соединений с БД

### Критерии приемки
- Все методы соответствуют стандартам
- Нет критических ошибок
- Код проходит линтер

---

## Задача 5: Тестирование команд ✅
**Статус:** Готово к выполнению
**Приоритет:** Средний
**Оценка:** 2 часа

### Описание
Протестировать все конфигурационные команды.

### Тест-кейсы

#### TC-1: Проверка прав доступа
- Не-администратор вызывает команду
- Ожидается: сообщение об отказе в доступе

#### TC-2: Reload Config
- Администратор вызывает `/reload_config`
- Ожидается: конфигурация перезагружена, сообщение об успехе

#### TC-3: Config Status
- Администратор вызывает `/config_status`
- Ожидается: отображение статуса конфигурации

#### TC-4: List Parsing Rules
- Администратор вызывает `/list_parsing_rules`
- Ожидается: список всех правил парсинга

#### TC-5: Add Parsing Rule
- Администратор вызывает `/add_parsing_rule TestBot "pattern" 1.5 points`
- Ожидается: правило добавлено

#### TC-6: Update Parsing Rule
- Администратор вызывает `/update_parsing_rule 1 multiplier 2.0`
- Ожидается: правило обновлено

#### TC-7: Export Config
- Администратор вызывает `/export_config`
- Ожидается: файл конфигурации отправлен

#### TC-8: Import Config
- Администратор отправляет файл с `/import_config`
- Ожидается: конфигурация импортирована

#### TC-9: Backup Config
- Администратор вызывает `/backup_config "test backup"`
- Ожидается: бэкап создан

#### TC-10: Restore Config
- Администратор вызывает `/restore_config <backup_id>`
- Ожидается: конфигурация восстановлена

#### TC-11: List Backups
- Администратор вызывает `/list_backups`
- Ожидается: список бэкапов

#### TC-12: Validate Config
- Администратор вызывает `/validate_config`
- Ожидается: результаты валидации

### Критерии приемки
- Все тест-кейсы пройдены
- Нет критических ошибок
- Логи корректны

---

## Задача 6: Обновление документации ✅
**Статус:** Готово к выполнению
**Приоритет:** Низкий
**Оценка:** 1 час

### Описание
Обновить документацию с описанием новых команд.

### Файлы
- `README.md`
- `docs/ИНСТРУКЦИЯ_ПАРСИНГ.md`

### Действия
1. Добавить раздел "Конфигурационные команды"
2. Описать каждую команду
3. Добавить примеры использования
4. Добавить troubleshooting

### Структура документации
```markdown
## Конфигурационные команды

### /reload_config
Перезагружает конфигурацию без перезапуска бота.

**Использование:**
```
/reload_config
```

**Требования:** Права администратора

**Пример:**
```
/reload_config
```

### /config_status
Показывает текущий статус конфигурации.

...
```

### Критерии приемки
- Все команды документированы
- Есть примеры использования
- Документация понятна

---

## Задача 7: Финальная проверка и деплой ✅
**Статус:** Готово к выполнению
**Приоритет:** Высокий
**Оценка:** 30 минут

### Описание
Финальная проверка перед деплоем.

### Чек-лист
- [ ] Все команды зарегистрированы
- [ ] Все методы реализованы
- [ ] Тесты пройдены
- [ ] Документация обновлена
- [ ] Код прошел ревью
- [ ] Нет критических ошибок
- [ ] Логирование работает
- [ ] База данных готова

### Действия
1. Запустить бота в тестовом режиме
2. Проверить каждую команду вручную
3. Проверить логи
4. Проверить производительность
5. Задеплоить на продакшн

### Критерии приемки
- Бот работает стабильно
- Все команды доступны
- Нет критических ошибок в логах

---

## Общий прогресс

- [x] Задача 1: Инициализация ConfigurationCommands
- [x] Задача 2: Создание методов-оберток
- [x] Задача 3: Регистрация команд
- [x] Задача 4: Проверка ConfigurationCommands
- [x] Задача 5: Тестирование
- [x] Задача 6: Документация
- [ ] Задача 7: Финальная проверка

**Общая оценка:** ~7 часов
**Статус:** Почти завершено, осталась финальная проверка
